
image: "hub.8ops.top/third/kibana"
imageTag: "7.17.3"

elasticsearchHosts: "https://elasticsearch-client:9200"

# secretMounts:
#   - name: elastic-certificates
#     secretName: elastic-certificates
#     path: /usr/share/elasticsearch/config/certs
# 
# kibanaConfig: 
#   kibana.yml: |
#     xpack.security.enabled: true
#     xpack.security.transport.ssl.enabled: true
#     xpack.security.transport.ssl.verification_mode: certificate
#     xpack.security.transport.ssl.keystore.path: /usr/share/elasticsearch/config/certs/elastic-certificates.p12
#     xpack.security.transport.ssl.truststore.path: /usr/share/elasticsearch/config/certs/elastic-certificates.p12
#     # xpack.security.http.ssl.enabled: true
#     # xpack.security.http.ssl.truststore.path: /usr/share/elasticsearch/config/certs/elastic-certificates.p12
#     # xpack.security.http.ssl.keystore.path: /usr/share/elasticsearch/config/certs/elastic-certificates.p12
#     # i18n.locale: "zh-CN"
#     # xpack.reporting.encryptionKey: "zGFTX0cy3ubYVmzuunACDZuRj0PALqOM"

kibanaConfig:
  kibana.yml: |
    server.ssl:
      enabled: true
      key: /usr/share/kibana/config/certs/elastic-certificate.pem
      certificate: /usr/share/kibana/config/certs/elastic-certificate.pem
    xpack.security.encryptionKey: ${KIBANA_ENCRYPTION_KEY}
    elasticsearch.ssl:
      certificateAuthorities: /usr/share/kibana/config/certs/elastic-certificate.pem
      verificationMode: certificate

protocol: https

secretMounts:
  - name: elastic-certificate-pem
    secretName: elastic-certificate-pem
    path: /usr/share/kibana/config/certs


extraEnvs:
  - name: ELASTIC_USERNAME
    valueFrom:
      secretKeyRef:
        name: elastic-credentials
        key: username
  - name: ELASTIC_PASSWORD
    valueFrom:
      secretKeyRef:
        name: elastic-credentials
        key: password
  - name: 'KIBANA_ENCRYPTION_KEY'
    valueFrom:
      secretKeyRef:
        name: kibana
        key: encryptionkey

resources:
  requests:
    cpu: "1"
    memory: "2Gi"
  limits:
    cpu: "1"
    memory: "2Gi"

ingress:
  enabled: true
  className: "external"
  hosts:
    - host: kibana.8ops.top
      paths:
        - path: /
  tls: 
    - secretName: tls-8ops.top
      hosts:
        - kibana.8ops.top


